(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/output/output"],{2477:function(t,e,n){"use strict";n.r(e);var o=n("7f12"),i=n("7595");for(var s in i)"default"!==s&&function(t){n.d(e,t,function(){return i[t]})}(s);n("3068");var a=n("2877"),u=Object(a["a"])(i["default"],o["a"],o["b"],!1,null,"6138710a",null);e["default"]=u.exports},"27a3":function(t,e,n){"use strict";(function(t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n("5b83"),s=a(n("814b"));function a(t){return t&&t.__esModule?t:{default:t}}function u(t,e){return l(t)||c(t,e)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function c(t,e){var n=[],o=!0,i=!1,s=void 0;try{for(var a,u=t[Symbol.iterator]();!(o=(a=u.next()).done);o=!0)if(n.push(a.value),e&&n.length===e)break}catch(r){i=!0,s=r}finally{try{o||null==u["return"]||u["return"]()}finally{if(i)throw s}}return n}function l(t){if(Array.isArray(t))return t}var d=function(){return n.e("components/uni-ui/uni-popup/uni-popup").then(n.bind(null,"b037"))},f=function(){return Promise.all([n.e("common/vendor"),n.e("components/image/choose")]).then(n.bind(null,"a22c"))},p=function(){return n.e("components/image/compress").then(n.bind(null,"7a9a"))},h={components:{choose:f,compress:p,uniPopup:d},data:function(){return{index:0,clear:!1,isYasuo:!0,maxwh:1080,quality:1,token:"",typeList:["电子产品","日常用品","寻求帮助","失物招领","我要吐槽","校园交友"],typeList2:["Electronics","Daliyuse","Gethelp","Lostfound","MakeComplain","Friend"],fileLength:0,videoSrc:null,progress:0,uploadindex:1,account:"",stars:[1,2,3,4,5],imgList:[],sendDate:{content:"",title:""}}},onLoad:function(){var t=getApp();this.account=t.globalData.account,this.token=t.globalData.token},onReady:function(){this.videoContext=t.createVideoContext("myVideo",this)},computed:{count:function(){return 6-this.imgList.length}},watch:{progress:function(t,e){t<e&&this.uploadindex++}},methods:{deleteVideo:function(){this.videoContext.stop(),this.videoSrc=null},bindPickerChange:function(t){this.index=t.target.value,this.sendDate.type=this.typeList2[this.index]},videoErrorCallback:function(t){console.log(o("视频错误信息:"," at pages\\output\\output.vue:127")),console.log(o(t.target.errMsg," at pages\\output\\output.vue:128"))},compressImg:function(t){console.log(o(t," at pages\\output\\output.vue:131"))},takeVideo:function(){var e=this;t.chooseVideo({count:1,maxDuration:10,sourceType:["camera"],success:function(t){e.videoSrc=t.tempFilePath}})},changeIndicatorDots:function(t){this.isYasuo=!this.isYasuo},openLoading:function(){this.$refs.popup.open()},fileChange:function(t){this.imgList=t},chooseStar:function(t){this.sendDate.score=t},checkData:function(){return this.sendDate.title&&this.sendDate.content?!this.sendDate.title.length>64?(t.showToast({title:"标题过长!",position:"bottom"}),!1):!this.sendDate.content.length>256?(t.showToast({title:"内容过长!",position:"bottom"}),!1):!!this.sendDate.type||(t.showToast({title:"请选择发布类型!",position:"bottom"}),!1):(t.showToast({title:"标题和内容不能为空!",position:"bottom"}),!1)},send:function(){var e=this,n=this;if(this.sendDate.type=this.typeList2[this.index],this.checkData())if(this.fileLength=0,this.uploadindex=1,t.showLoading({title:"处理中...",mask:!0}),this.isYasuo)0==n.imgList.length?r([],this.sendDate):this.$refs.compress.yasuoImg(n.imgList).then(function(t){var n=t.map(function(t,e){return{name:"image"+e,uri:t.tempFilePath}});r(n,e.sendDate)});else if(0==n.imgList.length)r([],this.sendDate);else{var a=n.imgList.map(function(t,e){return{name:"image"+e,uri:t}});r(a,n.sendDate)}function r(e,a){if(t.hideLoading(),n.videoSrc&&(e.push({uri:n.videoSrc,name:"video"}),n.videoContext.stop(),n.videoSrc=null),n.fileLength=e.length,a.token=n.token,n.fileLength>0){n.openLoading();var r=t.uploadFile({url:s.default.OutPut,files:e,formData:a,success:function(e){200===e.statusCode&&(t.showToast({title:"发布成功!",position:"bottom"}),n.clear=!0,n.imgList=[],n.sendDate={title:"",content:"",type:""}),n.$refs.popup.close()},fail:function(t){n.$refs.popup.close()}});r.onProgressUpdate(function(t){n.progress=t.progress,t.progress})}else t.showLoading({title:"发布中...",mask:!0}),(0,i.OutPut)(a).then(function(e){t.hideLoading();var i=u(e,2),s=(i[0],i[1]);console.log(o(s," at pages\\output\\output.vue:230"));var a=s.data.data;"error"==s.data.type?plus.nativeUI.toast(a):"success"==s.data.type&&(n.sendDate={title:"",content:"",type:""},plus.nativeUI.toast("发布成功！"))}).catch(function(e){plus.nativeUI.toast("服务器异常"),t.hideLoading()})}}}};e.default=h}).call(this,n("6e42")["default"],n("0de9")["default"])},3068:function(t,e,n){"use strict";var o=n("b6bc"),i=n.n(o);i.a},"391c":function(t,e,n){"use strict";(function(t){n("4fad"),n("921b");o(n("66fd"));var e=o(n("2477"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},7595:function(t,e,n){"use strict";n.r(e);var o=n("27a3"),i=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,function(){return o[t]})}(s);e["default"]=i.a},"7f12":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"a",function(){return o}),n.d(e,"b",function(){return i})},b6bc:function(t,e,n){}},[["391c","common/runtime","common/vendor"]]]);